<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="enableOps RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="enableOps Atom Feed"><title data-react-helmet="true">Getting started with Google Cloud &amp; Terraform | enableOps</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://enableops.io/blog/getting-started-with-google-cloud-terraform"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="Getting started with Google Cloud &amp; Terraform | enableOps"><meta data-react-helmet="true" name="description" content="Thousands of startups start to use cloud every day and itâ€™s truly a great way to start building your first infrastructure for new project."><meta data-react-helmet="true" property="og:description" content="Thousands of startups start to use cloud every day and itâ€™s truly a great way to start building your first infrastructure for new project."><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2021-11-17T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/yellowmegaman"><meta data-react-helmet="true" property="article:tag" content="getting_started"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://enableops.io/blog/getting-started-with-google-cloud-terraform"><link data-react-helmet="true" rel="alternate" href="https://enableops.io/blog/getting-started-with-google-cloud-terraform" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://enableops.io/blog/getting-started-with-google-cloud-terraform" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.eda30161.css">
<link rel="preload" href="/assets/js/runtime~main.58e4649b.js" as="script">
<link rel="preload" href="/assets/js/main.f7bf9886.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/small-logo.png" alt="enableOps Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/small-logo.png" alt="enableOps Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">enableOps</b></a><a class="navbar__item navbar__link" href="/docs/intro">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro">Create cluster ðŸš€</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_q+wC thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_9G5K margin-bottom--md">Recent posts</div><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/argocd-with-public-helm-charts-and-private-git">ArgoCD with public charts and private values.yaml</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/what-is-gitops-argocd">What is GitOps? The ArgoCD version</a></li><li class="sidebarItem_cjdF"><a aria-current="page" class="sidebarItemLink_zyXk sidebarItemLinkActive_wcJs" href="/blog/getting-started-with-google-cloud-terraform">Getting started with Google Cloud &amp; Terraform</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_d4p0" itemprop="headline">Getting started with Google Cloud &amp; Terraform</h1><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2021-11-17T00:00:00.000Z" itemprop="datePublished">November 17, 2021</time> Â· <!-- -->4 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/yellowmegaman" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/yellowmegaman.png" alt="Dmitry Rozhdestvenskiy"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/yellowmegaman" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Dmitry Rozhdestvenskiy</span></a></div><small class="avatar__subtitle" itemprop="description">Internal Engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Thousands of startups start to use cloud every day and itâ€™s truly a great way to start building your first infrastructure for new project.</p><p>Most of the time people that are delegated with such tasks are very excited and also are quite limited in time. But the cloud is ever-expanding system with millions of features and some not really evident defaults. It is really hard to understand everything from first go, if you are not some 10 YOE professional.</p><p>But the most important thing â€“ itâ€™s incredibly hard to repeat all actions after something complex has already been set up. This is the moment when IaC (Infrastructure as code) comes in handy! And the best choice for that nowadays is Hashicorp Terraform. It has big community, lotâ€™s of official modules and it is very stable and extendable.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="start-using-google-cloud">Start using Google Cloud<a class="hash-link" href="#start-using-google-cloud" title="Direct link to heading">â€‹</a></h2><p>Whenever you are using personal account, or Google Workspace was already set up, actions are basically identical. You can head over to <a href="http://cloud.google.com/" target="_blank" rel="noopener noreferrer">http://cloud.google.com/</a> to activate your cloud account. You may also want to activate your free trial, usually a message appears at the top of the page or in the center.
<img alt="Google Cloud" src="/assets/images/google-cloud-410293a525ce3613a92913130c2b94a6.png"></p><p>If you chose to proceed with this great offer, or decided to skip it for now, you are just few steps away from getting proper IaC going with your new cloud account.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="download-and-install-gcloud-google-cloud-sdk">Download and install gcloud (Google Cloud SDK)<a class="hash-link" href="#download-and-install-gcloud-google-cloud-sdk" title="Direct link to heading">â€‹</a></h2><p>Mac users can user <a href="https://brew.sh/" target="_blank" rel="noopener noreferrer">brew</a> for that, otherwise you can follow download instructions <a href="https://cloud.google.com/sdk/docs/install" target="_blank" rel="noopener noreferrer">here</a>.</p><p>Brew installation example:</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">brew </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> google-cloud-sdk</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>After installation is complete itâ€™s time to authenticate your gcloud cli</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud auth login</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>New tab in your browser will open to choose the account to use with gcloud. Important note here â€“ you need to choose the proper account which was used to activate your new Google Cloud.
<img alt="Google Cloud Sign In" src="/assets/images/google-cloud-signin-288fd3eb283587663fed267f391b1d21.png"></p><p>Now that we have gcloud authenticated, we should set the project id. Project id can be found on main Dashboard page of google cloud.
<img alt="Google Cloud Project Info" src="/assets/images/google-cloud-project-aed18f84b043becf2d4edb4c3f6a9526.png"></p><p>Now that we have that id, letâ€™s set it for gcloud and verify our newly added auth:</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">$ gcloud config </span><span class="token builtin class-name">set</span><span class="token plain"> project someproject-1337</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Updated property </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">core/project</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yellowmegaman@Dmitrys-MacBook-Air ~ % gcloud auth list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Credentialed Accounts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ACTIVE  ACCOUNT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*       someone@somedomain.tld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">To </span><span class="token builtin class-name">set</span><span class="token plain"> the active account, run:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $ gcloud config </span><span class="token builtin class-name">set</span><span class="token plain"> account </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable" style="color:#36acaa">ACCOUNT</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Awesome!</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="creating-custom-role-and-serviceaccount-for-terraform">Creating custom role and ServiceAccount for terraform<a class="hash-link" href="#creating-custom-role-and-serviceaccount-for-terraform" title="Direct link to heading">â€‹</a></h2><p>Terraform requires a way to interact with any cloud or service. With Google Cloud the most preferred way is ServiceAccount which is granted some roles to perform actions.</p><p>First we create the role. We want to have a role that is permitted to interact with container clusters (GKE), cloud storage buckets (GCS), and create/update/delete ServiceAccounts. You can always add more permissions, or remove them.</p><p>Save this yaml code to your disk, like <code>terraform-Role.yaml</code></p><div class="codeBlockContainer_J+bg language-yaml theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">terraform-Role.yaml</div><div class="codeBlockContent_csEI yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> terraform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> GA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> terraform IaC role</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">includedPermissions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> compute.instanceGroupManagers.get</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> container.clusters.create</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> container.clusters.delete</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> container.clusters.get</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> container.clusters.getCredentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> container.nodes.get</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> container.nodes.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> container.operations.get</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> iam.serviceAccounts.create</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> iam.serviceAccounts.delete</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> iam.serviceAccounts.get</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> iam.serviceAccounts.getAccessToken</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> iam.serviceAccounts.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> iam.serviceAccounts.update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> storage.buckets.create</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> storage.buckets.delete</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> storage.buckets.get</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> storage.objects.create</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> storage.objects.delete</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> storage.objects.get</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> storage.objects.getIamPolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> storage.objects.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> storage.objects.setIamPolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> storage.objects.update</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Now we can create the role (replace <code>&lt;project_id&gt;</code> with your value):</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud iam roles create </span><span class="token string" style="color:#e3116c">&quot;terraform&quot;</span><span class="token plain"> --project</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&lt;project_id&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    --file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">terraform-Role.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Letâ€™s create terraform ServiceAccount and couple of role bindings (replace <code>&lt;project_id&gt;</code> with your value):</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">$ gcloud iam service-accounts create </span><span class="token string" style="color:#e3116c">&quot;terraform&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                --description</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Terraform IaC service account&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                --display-name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;terraform&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ gcloud projects add-iam-policy-binding </span><span class="token string" style="color:#e3116c">&quot;&lt;project_id&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   --member</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;serviceAccount:terraform@&lt;project_id&gt;.iam.gserviceaccount.com&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   --role</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;projects/&lt;project_id&gt;/roles/terraform&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ gcloud projects add-iam-policy-binding </span><span class="token string" style="color:#e3116c">&quot;&lt;project_id&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   --member</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;serviceAccount:terraform@&lt;project_id&gt;.iam.gserviceaccount.com&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   --role</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;roles/iam.serviceAccountUser&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ gcloud projects add-iam-policy-binding </span><span class="token string" style="color:#e3116c">&quot;&lt;project_id&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   --member</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;serviceAccount:terraform@&lt;project_id&gt;.iam.gserviceaccount.com&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   --role</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;roles/container.admin&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Now we can head over to <a href="https://console.cloud.google.com/iam-admin/iam" target="_blank" rel="noopener noreferrer">IAM &amp; Admin</a> in Google Cloud to verify the results:
<img alt="Google Cloud IAM &amp;amp; Admin" src="/assets/images/google-cloud-iam-7d1c1ce414d757e79492563e408bb185.png"></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="creating-the-serviceaccount-key">Creating the ServiceAccount key<a class="hash-link" href="#creating-the-serviceaccount-key" title="Direct link to heading">â€‹</a></h2><p>Now that we have a ServiceAccount with proper roles attached, we need to obtain ServiceAccount key to provide it to terraform. Letâ€™s create one (replace <code>&lt;project_id&gt;</code> with your value):</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud iam service-accounts keys create terraform.json </span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --iam-account</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">terraform@</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">project_id</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">.iam.gserviceaccount.com</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>After running this command you will have ServiceAccount json key that can be used for IaC with terraform and for many other services that do work with Google Cloud.</p><p>To use it with terraform you can just export env variable:</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">GOOGLE_CREDENTIALS</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">path_to_your_key.json</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>What the benefits of using IaC from the start?</p><ul><li>solid backup of configuration of all you infrastructure parts</li><li>audit log of actions (if infra code is managed in VCS)</li><li>predictable state of infrastructure</li><li>hand-picked permissions, not just <code>Owner</code> role assigned to terraform as seen in many companies</li><li>better understanding whatâ€™s happening, instead of clicking random things on Web UI</li></ul></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_xD8n"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/getting-started">getting_started</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/what-is-gitops-argocd"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« <!-- -->What is GitOps? The ArgoCD version</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></main><div class="col col--2"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#start-using-google-cloud" class="table-of-contents__link toc-highlight">Start using Google Cloud</a></li><li><a href="#download-and-install-gcloud-google-cloud-sdk" class="table-of-contents__link toc-highlight">Download and install gcloud (Google Cloud SDK)</a></li><li><a href="#creating-custom-role-and-serviceaccount-for-terraform" class="table-of-contents__link toc-highlight">Creating custom role and ServiceAccount for terraform</a></li><li><a href="#creating-the-serviceaccount-key" class="table-of-contents__link toc-highlight">Creating the ServiceAccount key</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Manual</a></li></ul></div><div class="col footer__col"><div class="footer__title">Socials</div><ul class="footer__items"><li class="footer__item"><a href="https://www.linkedin.com/company/enableops" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/enableops" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/enableops" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 enableOps. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.58e4649b.js"></script>
<script src="/assets/js/main.f7bf9886.js"></script>
</body>
</html>