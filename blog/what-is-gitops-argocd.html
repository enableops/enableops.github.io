<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="enableOps RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="enableOps Atom Feed"><title data-react-helmet="true">What is GitOps? The ArgoCD version | enableOps</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://enableops.io/blog/what-is-gitops-argocd"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="What is GitOps? The ArgoCD version | enableOps"><meta data-react-helmet="true" name="description" content="GitOps is an approach. It‚Äôs not a product, not a tool. You can deliver software updates to the cloud, to Tesla car or hobby project based on Raspberry Pi with the help of GitOps."><meta data-react-helmet="true" property="og:description" content="GitOps is an approach. It‚Äôs not a product, not a tool. You can deliver software updates to the cloud, to Tesla car or hobby project based on Raspberry Pi with the help of GitOps."><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2021-11-18T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/yellowmegaman"><meta data-react-helmet="true" property="article:tag" content="gitops"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://enableops.io/blog/what-is-gitops-argocd"><link data-react-helmet="true" rel="alternate" href="https://enableops.io/blog/what-is-gitops-argocd" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://enableops.io/blog/what-is-gitops-argocd" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.eda30161.css">
<link rel="preload" href="/assets/js/runtime~main.4e480706.js" as="script">
<link rel="preload" href="/assets/js/main.2676c747.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/small-logo.png" alt="enableOps Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/small-logo.png" alt="enableOps Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">enableOps</b></a><a class="navbar__item navbar__link" href="/docs/intro">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro">Create cluster üöÄ</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_q+wC thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_9G5K margin-bottom--md">Recent posts</div><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/argocd-with-public-helm-charts-and-private-git">ArgoCD with public charts and private values.yaml</a></li><li class="sidebarItem_cjdF"><a aria-current="page" class="sidebarItemLink_zyXk sidebarItemLinkActive_wcJs" href="/blog/what-is-gitops-argocd">What is GitOps? The ArgoCD version</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/getting-started-with-google-cloud-terraform">Getting started with Google Cloud &amp; Terraform</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_d4p0" itemprop="headline">What is GitOps? The ArgoCD version</h1><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2021-11-18T00:00:00.000Z" itemprop="datePublished">November 18, 2021</time> ¬∑ <!-- -->5 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/yellowmegaman" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/yellowmegaman.png" alt="Dmitry Rozhdestvenskiy"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/yellowmegaman" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Dmitry Rozhdestvenskiy</span></a></div><small class="avatar__subtitle" itemprop="description">Internal Engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>GitOps is an approach. It‚Äôs not a product, not a tool. You can deliver software updates to the cloud, to Tesla car or hobby project based on Raspberry Pi with the help of GitOps.</p><p>Main thing to note here ‚Äì unlike how operations were carried out in the past, with GitOps we can be sure not to miss <em>how</em> some operation was performed, because everything is stored (in git) now.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="moving-parts">Moving parts<a class="hash-link" href="#moving-parts" title="Direct link to heading">‚Äã</a></h2><ul><li>application or automation code</li><li>VCS to store this code in</li><li>GitOps component which is performing an update</li><li>access to the environment which needs to be updated</li></ul><p>General scheme is quite simple ‚Äì you change something, update is got deployed automatically somewhere. Forget about old-school uploading of artefacts to remote host and running some commands afterwards.
<img alt="Moving parts" src="/assets/images/moving-parts-d00d5284e790fb665a89573f65e26f27.png"></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="benefits">Benefits<a class="hash-link" href="#benefits" title="Direct link to heading">‚Äã</a></h2><ul><li>Deployment change is peer-reviewed</li><li>Full audit-log of actions performed against environment are stored in git and versioned</li><li>No need for personal access to environments, only the GitOps component has rights to perform update, on the behalf of programmatic means access like ServiceAccount</li><li>Easy to track changes from last deployment</li><li>Easy rollback to the previous version</li><li>Nice web UI üòÅ</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="argocd">ArgoCD<a class="hash-link" href="#argocd" title="Direct link to heading">‚Äã</a></h2><p>Let‚Äôs install ArgoCD and connect it to GKE cluster</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">terminal</div><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> argo </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">https://argoproj.github.io/argo-helm</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> argocd --create-namespace </span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      --namespace argocd </span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      --set dex.enabled</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">false argo/argo-cd</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>For this example we‚Äôre skipping ArgoCD DEX component, because installation is performed locally on docker for desktop kubernetes.</p><p>Now we can get the password for admin user:</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">terminal</div><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl -n argocd get secret argocd-initial-admin-secret </span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -o </span><span class="token assign-left variable" style="color:#36acaa">jsonpath</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;{.data.password}&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> base64 -d</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Port-forward ArgoCD server to access it locally:</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">terminal</div><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl port-forward service/argocd-server -n argocd </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">:443</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Now we can install ArgoCD CLI to add remove clusters. We also do need to authenticate ourselves against our local install. Use admin password from above:</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">$ brew </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> argocd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ argocd login </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WARNING: server certificate had error: x509: cannot validate certificate </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1 because it doesn</span><span class="token string" style="color:#e3116c">&#x27;t contain any IP SANs. Proceed insecurely (y/n)? y</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Username: admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Password:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">&#x27;</span><span class="token plain">admin:login</span><span class="token string" style="color:#e3116c">&#x27; logged in successfully</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Context &#x27;</span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:8080&#x27; updated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ argocd cluster list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVER                          NAME        VERSION  STATUS   MESSAGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">https://kubernetes.default.svc</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">  in-cluster           Unknown  Cluster has no application and not being monitored.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>We can see now that ArgoCD is authenticated and shows the cluster which it is deployed into.</p><p>Now let&#x27;s add some remote GKE cluster from Google Cloud:</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">$ gcloud container clusters get-credentials production --zone us-central1-f --project someproject-1337</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Fetching cluster endpoint and auth data.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeconfig entry generated </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> production.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl config get-contexts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CURRENT   NAME                                          CLUSTER                                         AUTHINFO                                     NAMESPACE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          docker-desktop                                docker-desktop                                  docker-desktop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*         gke_someproject-1337_us-central1-f_production gke_someproject-1337_us-central1-f_production   gke_someproject-1337_us-central1-f_production</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">GOOGLE_CREDENTIALS</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">terraform.json </span><span class="token comment" style="color:#999988;font-style:italic"># we specify our ServiceAccount key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ argocd cluster </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> gke_someproject-1337_us-central1-f_production</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WARNING: This will create a </span><span class="token function" style="color:#d73a49">service</span><span class="token plain"> account </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable" style="color:#36acaa">argocd-manager</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"> on the cluster referenced by context </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable" style="color:#36acaa">gke_someproject-1337_us-central1-f_argocd</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"> with full cluster level admin privileges. Do you want to </span><span class="token builtin class-name">continue</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">y/N</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">? y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">0004</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> ClusterRole </span><span class="token string" style="color:#e3116c">&quot;argocd-manager-role&quot;</span><span class="token plain"> created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">0005</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> ClusterRoleBinding </span><span class="token string" style="color:#e3116c">&quot;argocd-manager-role-binding&quot;</span><span class="token plain"> updated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Cluster </span><span class="token string" style="color:#e3116c">&#x27;https://555.555.555.555&#x27;</span><span class="token plain"> added</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ argocd cluster list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVER                          NAME                                             VERSION  STATUS   MESSAGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">https://555.555.555.555         gke_someproject-1337_us-central1-f_production    Unknown  Cluster has no application and not being monitored.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">https://kubernetes.default.svc  in-cluster                                       Unknown  Cluster has no application and not being monitored.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>What happened here?</p><ul><li>we got credentials for GKE cluster with the help of gcloud</li><li>looked at available kubectl contexts</li><li>exported ServiceAccount key location as env variable</li><li>added cluster to ArgoCD</li><li>checked that it was added properly</li></ul><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Important thing to note here. We&#x27;re using local credentials only once, after that ArgoCD creates it&#x27;s own k8s ServiceAccount in target cluster, this way authentication JWT token is not expiring, as it is with gcloud.</p></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="deployment">Deployment<a class="hash-link" href="#deployment" title="Direct link to heading">‚Äã</a></h2><p>Now we can deploy our app. We gonna skip VCS part for this example, it requires additional configuration for ArgoCD private repos. You can check it out <a href="https://argo-cd.readthedocs.io/en/release-1.8/user-guide/private-repositories/" target="_blank" rel="noopener noreferrer">here</a>.</p><p>Save this example Traefik deployment manifest to disk:</p><div class="codeBlockContainer_J+bg language-yaml theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">Application-traefik.yaml</div><div class="codeBlockContent_csEI yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> argoproj.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> traefik</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">destination</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> traefik</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//555.555.555.555</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">project</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">syncPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">automated</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">prune</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">selfHeal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">syncOptions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Validate=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> CreateNamespace=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">repoURL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//helm.traefik.io/traefik</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">chart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;traefik&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">targetRevision</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10.6.2&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">helm</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service.type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ClusterIP&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Now we are applying it locally to our docker-desktop cluster where ArgoCD is resided. It, in turn will sync this workload to remote GKE cluster</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n argocd apply -f Application-traefik.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl config use-context gke_someproject-1337_us-central1-f_production</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n traefik get po</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                       READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">traefik-65c68d8dd7-qzmzp   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          7s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Let‚Äôs check the web UI of our ArgoCD.</p><p>Open <a href="https://127.0.0.1:8080" target="_blank" rel="noopener noreferrer">https://127.0.0.1:8080</a> and log in. Certificate will be invalid, but that‚Äôs OK for local testing installation. Provide admin password obtained in previous step.
<img alt="Screenshot of app in ArgoCD" src="/assets/images/app-view-421c533ba645f3bc41ea4ab2b0ce91d3.png"></p><p>Application details:
<img alt="Screenshot of app details in ArgoCD" src="/assets/images/app-details-eb3085a1ce1315ecb1262627d7fb648b.png"></p><p>Now we have firm connection between ArgoCD GitOps component and GKE cluster, woot!</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="git-part">Git part<a class="hash-link" href="#git-part" title="Direct link to heading">‚Äã</a></h2><p>We can now proceed with configuration of private repos to pull changes from git, or apply changes locally.</p><p>We need to place repository secret (e.g. private key) in kubernetes secrets in argocd namespace.</p><p>After that we can apply private repo configuration:</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">argocd repo </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> git@github.com:argoproj/argocd-example-apps.git </span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                --ssh-private-key-path ~/.ssh/id_rsa</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Define the app:</p><div class="codeBlockContainer_J+bg language-yaml theme-code-block"><div class="codeBlockContent_csEI yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> argoproj.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> guestbook</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> argocd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">destination</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> guestbook</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//555.555.555.555</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">project</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">syncPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">automated</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">prune</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">selfHeal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">syncOptions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Validate=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> CreateNamespace=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;guestbook&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">repoURL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//github.com/argoproj/argocd</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">example</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">apps</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">targetRevision</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> HEAD</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Check target cluster:</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n guestbook get po</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                            READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">guestbook-ui-85985d774c-ttn2p   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          23s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>From now on you can deploy applications from your private git repo. When you modify the files in <code>targetRevision</code> location, ArgoCD will update your cluster. Woot!</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_xD8n"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/gitops">gitops</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/argocd-with-public-helm-charts-and-private-git"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">¬´ <!-- -->ArgoCD with public charts and private values.yaml</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/getting-started-with-google-cloud-terraform"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Getting started with Google Cloud &amp; Terraform<!-- --> ¬ª</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#moving-parts" class="table-of-contents__link toc-highlight">Moving parts</a></li><li><a href="#benefits" class="table-of-contents__link toc-highlight">Benefits</a></li><li><a href="#argocd" class="table-of-contents__link toc-highlight">ArgoCD</a></li><li><a href="#deployment" class="table-of-contents__link toc-highlight">Deployment</a></li><li><a href="#git-part" class="table-of-contents__link toc-highlight">Git part</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Manual</a></li></ul></div><div class="col footer__col"><div class="footer__title">Socials</div><ul class="footer__items"><li class="footer__item"><a href="https://www.linkedin.com/company/enableops" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/enableops" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/enableops" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 enableOps. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.4e480706.js"></script>
<script src="/assets/js/main.2676c747.js"></script>
</body>
</html>